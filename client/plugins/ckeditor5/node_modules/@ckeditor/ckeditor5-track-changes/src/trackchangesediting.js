/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x217788 from'@ckeditor/ckeditor5-core/src/plugin';import _0x3e8d8d from'@ckeditor/ckeditor5-core/src/pendingactions';import _0x3fd5f0 from'@ckeditor/ckeditor5-collaboration-core/src/users';import _0x3f1ec9 from'@ckeditor/ckeditor5-engine/src/model/range';import _0x5d66bd from'@ckeditor/ckeditor5-engine/src/model/liverange';import _0x82cc9d from'@ckeditor/ckeditor5-engine/src/model/documentselection';import _0x3a2bc4 from'@ckeditor/ckeditor5-engine/src/model/treewalker';import _0x1c9696 from'@ckeditor/ckeditor5-utils/src/ckeditorerror';import _0x448c3e from'@ckeditor/ckeditor5-comments/src/comments/commentsrepository';import _0x8f867c from'./commands/trackchangescommand';import _0x5b8c7b from'./commands/acceptsuggestioncommand';import _0x430756 from'./commands/discardsuggestioncommand';import _0x44ec89 from'./commands/acceptallsuggestionscommand';import _0x5698a7 from'./commands/acceptselectedsuggestionscommand';import _0x451271 from'./commands/discardallsuggestionscommand';import _0x31c12e from'./commands/discardselectedsuggestionscommand';import _0x31787d from'./suggestion';import _0x20ff0f from'./suggestiondescriptionfactory';import _0x255215 from'@ckeditor/ckeditor5-utils/src/uid';import _0x59576c from'@ckeditor/ckeditor5-utils/src/priorities';import _0x29e645 from'@ckeditor/ckeditor5-utils/src/emittermixin';import _0xd082e5 from'@ckeditor/ckeditor5-utils/src/mix';import'../theme/suggestion.css';import'../theme/suggestionmarker.css';import _0x1efdc2 from'./integrations/alignment';import _0x3e6d54 from'./integrations/basicstyles';import _0x3475ff from'./integrations/blockquote';import _0x580ab4 from'./integrations/codeblock';import _0x38aef2 from'./integrations/comments';import _0x59de11 from'./integrations/deletecommand';import _0x37583b from'./integrations/entercommand';import _0x4022f3 from'./integrations/exportpdf';import _0x5df1e5 from'./integrations/font';import _0x1c8a1b from'./integrations/heading';import _0x12878e from'./integrations/highlight';import _0x5f23ff from'./integrations/horizontalline';import _0x21d545 from'./integrations/image';import _0x437278 from'./integrations/indent';import _0x39a3c7 from'./integrations/inputcommand';import _0x362244 from'./integrations/link';import tt from'./integrations/list';import it from'./integrations/mediaembed';import ot from'./integrations/mention';import st from'./integrations/pagebreak';import et from'./integrations/paragraph';import nt from'./integrations/removeformat';import rt from'./integrations/restrictededitingmode';import ct from'./integrations/selectall';import at from'./integrations/shiftentercommand';import ht from'./integrations/standardeditingmode';import ft from'./integrations/table';import ut from'./integrations/title';import gt from'./integrations/undo';import dt from'./utils/hashobject.js';export default class u extends _0x217788{static get['requires'](){return[_0x3fd5f0,_0x3e8d8d,_0x448c3e,_0x1efdc2,_0x3e6d54,_0x3475ff,_0x580ab4,_0x38aef2,_0x59de11,_0x37583b,_0x4022f3,_0x5df1e5,_0x1c8a1b,_0x12878e,_0x5f23ff,_0x21d545,_0x437278,_0x39a3c7,_0x362244,tt,it,ot,st,et,nt,rt,ct,at,ht,ft,ut,gt];}static get['pluginName'](){return'TrackChangesEditing';}constructor(_0xf1a617){function _0x104c0f(_0x47e790){return _0x47e790['map'](_0x309af2=>String['fromCharCode'](_0x309af2))['join']('');}super(_0xf1a617),this['set']('activeMarkers',[]),this['on']('change:activeMarkers',(_0x2a32e1,_0x2c0114,_0x47e105,_0x2ee71e)=>{this['_model']['change'](_0x2f3dec=>{for(const _0x2b432c of[..._0x2ee71e,..._0x47e105])this['_model']['markers']['has'](_0x2b432c)&&_0x2f3dec['updateMarker'](_0x2b432c);});}),this['_adapter']=null,this['_descriptionFactory']=new _0x20ff0f(this['editor']['model']['schema'],this['editor']['locale']),this['_suggestionFactory']=new mt(this['editor']),this['_suggestions']=new Map(),this['_commentsRepository']=_0xf1a617['plugins']['get'](_0x448c3e),this['_enabledCommands']=new Set(),this['_model']=this['editor']['model'],this['_suggestionState']=new WeakMap(),this[_0x104c0f([0x5f,0x65,0x78,0x65,0x63,0x75,0x74,0x65,0x53,0x75,0x67,0x67,0x65,0x73,0x74,0x69,0x6f,0x6e])]=_0x104c0f([0x34,0x30,0x34,0x30,0x31,0x38,0x36,0x30]);}['init'](){const _0x59b499=this['editor'];_0x59b499['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion','view':_0x4174fe=>{const {id:_0x1c4b3a,type:_0x5c2245}=this['_splitMarkerName'](_0x4174fe['markerName']),_0x18622a=['ck-suggestion-marker','ck-suggestion-marker-'+_0x5c2245],_0x9873b6=this['activeMarkers']['includes'](_0x4174fe['markerName']);return _0x9873b6&&_0x18622a['push']('ck-suggestion-marker--active'),{'classes':_0x18622a,'attributes':{'data-suggestion':_0x1c4b3a},'priority':_0x9873b6?0xbc2:0xbb8};}}),_0x59b499['conversion']['for']('dataDowncast')['markerToData']({'model':'suggestion'}),_0x59b499['conversion']['for']('upcast')['elementToElement']({'view':{'name':'suggestion','attribute':{'id':/^\w/,'suggestionType':/^\w/}},'model':(_0x25cadb,{writer:_0x359447})=>{let _0x398065='suggestion:'+_0x25cadb['getAttribute']('suggestion-type')+':'+_0x25cadb['getAttribute']('id');return _0x25cadb['getAttribute']('marker-count')&&(_0x398065+=':'+_0x25cadb['getAttribute']('marker-count')),_0x359447['createElement']('$marker',{'data-name':_0x398065});}}),_0x59b499['conversion']['for']('upcast')['dataToMarker']({'view':'suggestion'}),_0x59b499['conversion']['for']('editingDowncast')['add'](_0x21513f=>{_0x21513f['on']('addMarker:suggestion:formatBlock',(_0x559a28,_0x4613ce,_0x5b5d7e)=>{if(!_0x4613ce['item'])return;if(_0x4613ce['item']['is']('selection'))return void _0x5b5d7e['consumable']['consume'](_0x4613ce['item'],_0x559a28['name']);const _0x5005f4=_0x5b5d7e['mapper']['toViewElement'](_0x4613ce['item']);if(!(_0x4613ce['item']['is']('element')&&_0x59b499['model']['schema']['isBlock'](_0x4613ce['item'])&&!_0x5005f4['getCustomProperty']('addHighlight')))return;const {id:_0x5489c2}=this['_splitMarkerName'](_0x4613ce['markerName']);_0x5b5d7e['writer']['addClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock'],_0x5005f4),_0x5b5d7e['writer']['setAttribute']('data-suggestion',_0x5489c2,_0x5005f4),_0x5b5d7e['mapper']['bindElementToMarker'](_0x5005f4,_0x4613ce['markerName']),this['activeMarkers']['includes'](_0x4613ce['markerName'])?_0x5b5d7e['writer']['addClass']('ck-suggestion-marker--active',_0x5005f4):_0x5b5d7e['writer']['removeClass']('ck-suggestion-marker--active',_0x5005f4);for(const _0x1e7c50 of _0x59b499['model']['createRangeIn'](_0x4613ce['item'])['getItems']())_0x5b5d7e['consumable']['consume'](_0x1e7c50,_0x559a28['name']);_0x5b5d7e['consumable']['consume'](_0x4613ce['item'],_0x559a28['name']);},{'priority':'high'}),_0x21513f['on']('removeMarker:suggestion:formatBlock',(_0x44dd18,_0x377946,_0x1b7e8d)=>{const _0x5f4c81=_0x1b7e8d['mapper']['markerNameToElements'](_0x377946['markerName']);if(_0x5f4c81)for(const _0x385adb of _0x5f4c81)_0x385adb['getCustomProperty']('addHighlight')||(_0x1b7e8d['writer']['removeClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock','ck-suggestion-marker--active'],_0x385adb),_0x1b7e8d['writer']['removeAttribute']('data-suggestion',_0x385adb),_0x1b7e8d['mapper']['unbindElementFromMarkerName'](_0x385adb,_0x377946['markerName']));},{'priority':'high'});}),_0x59b499['model']['document']['registerPostFixer'](_0x3b33d5=>{let _0x498077=!0x1;const _0x2b5274=Array['from'](_0x59b499['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x26c3cb,data:_0x4242e9}of _0x2b5274){const {group:_0x4d0f48,type:_0x133be9,id:_0x362837}=this['_splitMarkerName'](_0x26c3cb);if('suggestion'!==_0x4d0f48)continue;const _0x363f7b=this['_suggestions']['get'](_0x362837);if(null!=_0x4242e9['newRange']){'formatInline'==_0x133be9&&(_0x498077=_0x498077||pt(_0x4242e9['newRange'],_0x26c3cb,_0x3b33d5,_0x59b499['model']['schema']));if(_0x4242e9['newRange']['isCollapsed']||'$graveyard'==_0x4242e9['newRange']['root']['rootName']||'formatBlock'==_0x133be9&&!wt(_0x4242e9['newRange']))_0x3b33d5['removeMarker'](_0x26c3cb),_0x498077=!0x0;else{if(!_0x363f7b||!_0x363f7b['isInContent'])continue;_0x498077=!!this['_joinWithAdjacentSuggestions'](_0x363f7b)||_0x498077;}}}return _0x498077;}),_0x59b499['model']['document']['registerPostFixer'](_0x21efb2=>{let _0x147a61=!0x1;for(const _0x501699 of _0x59b499['model']['document']['differ']['getChanges']()){if('insert'!=_0x501699['type'])continue;const _0x4afd7c=_0x501699['position']['getShiftedBy'](_0x501699['length']);if(_0x4afd7c['isAtEnd'])for(const _0x23aec8 of this['_suggestions']['values']()){if(_0x23aec8['isMultiRange']||!_0x23aec8['isInContent'])continue;if('formatBlock'!=_0x23aec8['type'])continue;const _0x36e94f=_0x23aec8['getFirstRange']();if(_0x36e94f['start']['parent']!=_0x36e94f['end']['parent']&&_0x36e94f['end']['isEqual'](_0x501699['position'])){const _0x3ad406=_0x59b499['model']['createRange'](_0x36e94f['start'],_0x4afd7c);_0x21efb2['updateMarker'](_0x23aec8['getFirstMarker'](),{'range':_0x3ad406}),_0x147a61=!0x0;}}}return _0x147a61;}),_0x59b499['model']['markers']['on']('update:suggestion',(_0x145709,_0x21594b,_0x3ebbba)=>{if(null==_0x3ebbba){const {id:_0x19fb49}=this['_splitMarkerName'](_0x21594b['name']),_0x4ae8db=this['_suggestions']['get'](_0x19fb49);_0x4ae8db&&_0x4ae8db['addMarkerName'](_0x21594b['name']);}}),_0x59b499['model']['document']['on']('change:data',()=>{const _0x1b1e10=Array['from'](_0x59b499['model']['document']['differ']['getChangedMarkers']());_0x1b1e10['sort']((_0x1496f2,_0x8c810)=>{const _0x2942a5=_0x1496f2['data']['oldRange'],_0x379945=_0x8c810['data']['oldRange'];return null===_0x2942a5&&null===_0x379945?0x0:null===_0x2942a5&&null!==_0x379945?-0x1:null!==_0x2942a5&&null===_0x379945?0x1:_0x2942a5['start']['isBefore'](_0x379945['start'])?-0x1:0x1;});const _0x2dd577=new Set();for(const {name:_0x2ed4f0,data:_0x4431a5}of _0x1b1e10){const {group:_0x1eb3d8,id:_0x590386}=this['_splitMarkerName'](_0x2ed4f0);if('suggestion'===_0x1eb3d8&&(null===_0x4431a5['oldRange']&&this['_handleNewSuggestionMarker'](_0x2ed4f0),null===_0x4431a5['newRange'])){const _0x5dfef5=this['_suggestions']['get'](_0x590386);_0x5dfef5['isInContent']?_0x2dd577['add'](_0x5dfef5):this['_removeSuggestion'](_0x5dfef5);}}for(const {name:_0x39af1a,data:_0x8eb506}of _0x1b1e10){const {group:_0x34808a,id:_0x1da3a8}=this['_splitMarkerName'](_0x39af1a);if('suggestion'!==_0x34808a)continue;const _0x24b82f=this['_suggestions']['get'](_0x1da3a8);null!=_0x8eb506['newRange']&&null!=_0x8eb506['oldRange']&&(this['_refreshSuggestionsChain'](_0x24b82f),_0x2dd577['add'](_0x24b82f['head']));}for(const _0x4e5ff7 of _0x2dd577)this['fire']('suggestionChanged',_0x4e5ff7);_0x2dd577['clear']();}),_0x59b499['model']['on']('applyOperation',(_0x1e0a50,_0x432a63)=>{const _0x3c3228=_0x432a63[0x0];if(!this['_suggestions']['size'])return;if(!_0x3c3228['isDocumentOperation'])return;if('transparent'==_0x3c3228['batch']['type'])return;let _0x221851,_0x3e5d1e;switch(_0x3c3228['type']){case'insert':_0x221851=_0x59b499['model']['createPositionAt'](_0x3c3228['position']),_0x3e5d1e=_0x221851['getShiftedBy'](_0x3c3228['howMany']);break;case'split':_0x221851=_0x59b499['model']['createPositionAt'](_0x3c3228['splitPosition']),_0x3e5d1e=_0x59b499['model']['createPositionAt'](_0x3c3228['moveTargetPosition']);break;case'move':_0x221851=_0x59b499['model']['createPositionAt'](_0x3c3228['targetPosition']),_0x3e5d1e=_0x221851['getShiftedBy'](_0x3c3228['howMany']);break;default:return;}const _0x1efc7b=_0x59b499['model']['createRange'](_0x221851,_0x3e5d1e);_0x59b499['model']['change'](()=>{for(const {suggestion:_0x2a4189,meta:_0x52aed6}of this['_findSuggestions'](_0x1efc7b)){if(_0x2a4189['isMultiRange'])continue;if('formatInline'==_0x2a4189['type'])continue;const _0x47763b=_0x2a4189['data']&&_0x2a4189['data']['multipleBlocks'];('formatBlock'!=_0x2a4189['type']||'split'==_0x3c3228['type']&&!_0x47763b)&&(_0x52aed6['containsRangeInObject']||'insertion'==_0x2a4189['type']&&_0x52aed6['isOwn']||_0x2a4189['getFirstRange']()['containsRange'](_0x1efc7b)&&this['_breakSuggestionMarker'](_0x2a4189,_0x221851,_0x3e5d1e));}});},{'priority':'lowest'}),_0x59b499['model']['on']('deleteContent',(_0x409300,_0x1c1e3b)=>{const _0x58041c=_0x1c1e3b[0x0],_0x22e9e1=_0x1c1e3b[0x1];if(_0x22e9e1&&_0x22e9e1['forceDefaultExecution'])return;if(!this['trackChangesCommand']['value'])return;if(_0x58041c['isCollapsed'])return;const _0x340631=_0x59b499['model']['schema'],{start:_0x565e2e,end:_0x38bf04}=_0x58041c['getFirstRange'](),_0x4ef8b7=_0x565e2e['nodeAfter']&&_0x340631['isObject'](_0x565e2e['nodeAfter'])?null:_0x340631['getNearestSelectionRange'](_0x565e2e,'forward'),_0x353ebd=_0x38bf04['nodeBefore']&&_0x340631['isObject'](_0x38bf04['nodeBefore'])?null:_0x340631['getNearestSelectionRange'](_0x38bf04,'backward'),_0x22a937=_0x59b499['model']['createRange'](_0x4ef8b7?_0x4ef8b7['start']:_0x565e2e,_0x353ebd?_0x353ebd['end']:_0x38bf04);_0x59b499['model']['change'](_0x58ea8b=>{this['markDeletion'](_0x22a937);const _0x555079=_0x59b499['model']['schema']['getNearestSelectionRange'](_0x22a937['start']);_0x58041c instanceof _0x82cc9d?_0x58ea8b['setSelection'](_0x555079):_0x58041c['setTo'](_0x555079);}),_0x409300['stop']();},{'priority':_0x59576c['normal']+0xa}),_0x59b499['model']['on']('insertContent',(_0x417cac,_0x109a3d)=>{const _0x1660ff=_0x109a3d[_0x109a3d['length']-0x1];_0x1660ff&&_0x1660ff['forceDefaultExecution']||this['trackChangesCommand']['value']&&(_0x59b499['model']['change'](()=>{let _0xa33970=_0x59b499['model']['insertContent'](_0x109a3d[0x0],_0x109a3d[0x1],_0x109a3d[0x2],_0x109a3d[0x3],{'forceDefaultExecution':!0x0});if(!_0xa33970)return;_0x417cac['return']=_0xa33970['clone']();const _0x102bb2=_0xa33970['end']['nodeBefore'],_0x3f5cb8=_0x59b499['model']['schema'];_0x102bb2&&_0x3f5cb8['isBlock'](_0x102bb2)&&!_0x3f5cb8['isObject'](_0x102bb2)&&(_0xa33970=_0x59b499['model']['createRange'](_0xa33970['start'],_0x59b499['model']['createPositionAt'](_0x102bb2,'end'))),this['markInsertion'](_0xa33970);}),_0x417cac['stop']());},{'priority':'high'}),this['trackChangesCommand']=new _0x8f867c(_0x59b499,this['_enabledCommands']),this['editor']['commands']['add']('trackChanges',this['trackChangesCommand']),this['enableCommand']('trackChanges');const _0x5fc878=new _0x5b8c7b(_0x59b499,this['_suggestions']);_0x59b499['commands']['add']('acceptSuggestion',_0x5fc878),this['enableCommand']('acceptSuggestion');const _0x132caa=new _0x430756(_0x59b499,this['_suggestions']);_0x59b499['commands']['add']('discardSuggestion',_0x132caa),this['enableCommand']('discardSuggestion'),_0x59b499['commands']['add']('acceptAllSuggestions',new _0x44ec89(_0x59b499,_0x5fc878,this['_suggestions'])),this['enableCommand']('acceptAllSuggestions'),_0x59b499['commands']['add']('discardAllSuggestions',new _0x451271(_0x59b499,_0x132caa,this['_suggestions'])),this['enableCommand']('discardAllSuggestions'),_0x59b499['commands']['add']('acceptSelectedSuggestions',new _0x5698a7(_0x59b499,_0x5fc878,this['_suggestions'])),this['enableCommand']('acceptSelectedSuggestions'),_0x59b499['commands']['add']('discardSelectedSuggestions',new _0x31c12e(_0x59b499,_0x132caa,this['_suggestions'])),this['enableCommand']('discardSelectedSuggestions');const _0x5a5de7=_0x59b499['plugins']['get'](_0x448c3e);this['listenTo'](_0x5a5de7,'addComment',(_0x1419df,{threadId:_0x5eb5b5})=>{const _0x4bbeb2=this['_suggestions']['get'](_0x5eb5b5);_0x4bbeb2&&_0x4bbeb2['commentThread']&&0x1===_0x4bbeb2['commentThread']['length']&&this['_updateSuggestionData'](_0x5eb5b5,{'hasComments':!0x0});},{'priority':'low'}),this['listenTo'](_0x5a5de7,'removeComment',(_0x16c2d4,{threadId:_0x5236ae})=>{const _0x54f545=this['_suggestions']['get'](_0x5236ae);_0x54f545&&_0x54f545['commentThread']&&!_0x54f545['commentThread']['length']&&this['_updateSuggestionData'](_0x5236ae,{'hasComments':!0x1});},{'priority':'low'});}set['adapter'](_0x10c8a0){if(this['_adapter'])throw new _0x1c9696('track-changes-adapter-already-set',this);this['_adapter']=_0x10c8a0;}get['adapter'](){return this['_adapter'];}['getSuggestions'](){return Array['from'](this['_suggestions']['values']());}['getSuggestion'](_0x39ad06){const _0x4537d3=this['_suggestions']['get'](_0x39ad06);if(!_0x4537d3)throw new _0x1c9696('track-changes-suggestion-not-found',this);return _0x4537d3;}['hasSuggestion'](_0x2bb1a2){return this['_suggestions']['has'](_0x2bb1a2);}['addSuggestionData'](_0x2ff57a){const {id:_0x29d852,authorId:_0x1f575a}=_0x2ff57a,[_0x3ff056,_0x20dc9d]=_0x2ff57a['type']['split'](':'),_0x134d21=this['_suggestions']['get'](_0x29d852)||this['_createSuggestion'](_0x3ff056,_0x20dc9d,_0x29d852,_0x1f575a);switch(this['_addThreadToSuggestion'](_0x134d21),this['_checkSuggestionCorrectness'](_0x134d21,_0x3ff056,_0x20dc9d||null,_0x1f575a),_0x134d21['createdAt']=_0x2ff57a['createdAt'],_0x2ff57a['data']&&(_0x134d21['data']=_0x2ff57a['data']),this['_suggestionState']['get'](_0x134d21)){case'notReady':this['_suggestionState']['set'](_0x134d21,'dataReady');break;case'markerReady':_0x134d21['isInContent']?(this['_suggestionState']['set'](_0x134d21,'ready'),this['fire']('suggestionLoaded',_0x134d21)):this['_suggestionState']['set'](_0x134d21,'removed');}return _0x134d21;}['enableCommand'](_0x2897ed,_0x207921){const _0x21abe7=this['editor']['commands']['get'](_0x2897ed);if(!_0x21abe7)throw new _0x1c9696('track-changes-command-not-found',this);this['_enabledCommands']['add'](_0x21abe7),_0x207921&&_0x21abe7['on']('execute',(_0x28a777,_0x206afe)=>{this['trackChangesCommand']['value']&&(_0x206afe['length']>0x0&&_0x206afe[_0x206afe['length']-0x1]&&_0x206afe[_0x206afe['length']-0x1]['forceDefaultExecution']||(_0x207921((..._0x3ec766)=>_0x21abe7['execute'](..._0x3ec766,{'forceDefaultExecution':!0x0}),..._0x206afe),_0x28a777['stop']()));},{'priority':'high'});}['markInsertion'](_0x3f7aad,_0x44cf4e=null){if(_0x3f7aad['isCollapsed'])return null;const _0x26262f=this['editor']['plugins']['get']('Users')['me'];for(const {suggestion:_0x229a86,meta:_0x1f4654}of this['_findSuggestions'](_0x3f7aad,'insertion'))if(_0x1f4654['isOwn']){if(_0x1f4654['isNextTo']&&_0x44cf4e==_0x229a86['subType']){const _0x5e7f97=_0x229a86['getFirstRange']();_0x5e7f97['start']['isEqual'](_0x3f7aad['end'])?this['_setSuggestionRange'](_0x229a86,this['_model']['createRange'](_0x3f7aad['start'],_0x5e7f97['end'])):this['_setSuggestionRange'](_0x229a86,this['_model']['createRange'](_0x5e7f97['start'],_0x3f7aad['end']));}return _0x229a86;}const _0x298998=_0x255215(),_0x2c6421=_0x26262f['id'],_0x265190=_0x44cf4e?'insertion:'+_0x44cf4e:'insertion',_0x3d8309=this['_setSuggestionData']({'id':_0x298998,'type':_0x265190,'createdAt':new Date(),'authorId':_0x2c6421});return this['_addSuggestionMarker'](_0x265190,_0x298998,_0x2c6421,_0x3f7aad),_0x3d8309;}['markMultiRangeInsertion'](_0x4eb97b,_0x480e62='multi'){const _0x8e82df=this['editor']['plugins']['get']('Users')['me'],_0x14c00c=this['_suggestionFactory']['getSuggestionCallback']('insertion',_0x480e62,'join');for(const _0x2507ef of this['getSuggestions']())if(_0x2507ef['author']['id']==_0x8e82df['id']&&'insertion'==_0x2507ef['type']&&_0x2507ef['subType']==_0x480e62&&(_0x14c00c(_0x2507ef['getRanges'](),_0x4eb97b)||_0x14c00c(_0x4eb97b,_0x2507ef['getRanges']()))){for(const _0x2b93bf of _0x4eb97b)_0x2507ef['addRange'](_0x2b93bf);return _0x2507ef;}for(const _0x3c3bb3 of _0x4eb97b)for(const {suggestion:_0x2179d0,meta:_0x29fe29}of this['_findSuggestions'](_0x3c3bb3,'insertion')){if(!_0x29fe29['isOwn'])continue;let _0x17b6c0=!0x0;for(const _0x3cdf75 of _0x2179d0['getRanges']())for(const _0x3c4d58 of _0x4eb97b)if(!_0x3cdf75['containsRange'](_0x3c4d58)){_0x17b6c0=!0x1;break;}if(_0x17b6c0)return _0x2179d0;}const _0x4b1632=_0x255215(),_0x547836=_0x8e82df['id'],_0x4242ee='insertion:'+_0x480e62,_0x37ae0c=this['_setSuggestionData']({'id':_0x4b1632,'type':_0x4242ee,'createdAt':new Date(),'authorId':_0x547836});for(const _0x5d3289 of _0x4eb97b)this['_addSuggestionMarker'](_0x4242ee,_0x4b1632,_0x547836,_0x5d3289,_0x31787d['getMultiRangeId']());return _0x37ae0c;}['markInlineFormat'](_0x357a62,_0x394e5a,_0x5d2630=null){if(_0x5d2630=_0x5d2630||kt(_0x394e5a),_0x357a62['isCollapsed'])return;const _0x5a5885=this['editor']['plugins']['get']('Users')['me'],_0x496c3e=[];for(const {suggestion:_0x34dbbb,meta:_0x25551f}of this['_findSuggestions'](_0x357a62,'insertion'))_0x25551f['isOwn']&&!_0x25551f['isInsideObject']&&_0x496c3e['push'](..._0x34dbbb['getRanges']());const _0x8fe3ab=function(_0x129116,_0x40f258){const _0x33866e=[];for(const _0x1a441e of _0x40f258){const _0x9ca1c7=_0x129116['getIntersection'](_0x1a441e);_0x9ca1c7&&_0x33866e['push'](_0x9ca1c7);}return _0x33866e;}(_0x357a62,_0x496c3e),_0x1440bf=function(_0x105832,_0x533846){const _0x522260=[_0x105832];for(const _0x3172fb of _0x533846){let _0x51300c=0x0;for(;_0x51300c<_0x522260['length'];){const _0x27e1d4=_0x522260[_0x51300c]['getDifference'](_0x3172fb);_0x522260['splice'](_0x51300c,0x1,..._0x27e1d4),_0x51300c+=_0x27e1d4['length'];}}return _0x522260;}(_0x357a62,_0x496c3e);_0x8fe3ab['length']&&this['_model']['change'](()=>{for(const _0x2f93d0 of _0x8fe3ab){this['_suggestionFactory']['getSuggestionCallback']('formatInline',_0x5d2630,'accept')([_0x2f93d0],_0x394e5a);}});for(const _0x49d9cf of _0x1440bf){let _0x55fb46=null,_0x2a0ec7=_0x49d9cf['start'],_0x207cb2=_0x49d9cf['end'];for(const {suggestion:_0x3c7a73,meta:_0x1a5cfd}of this['_findSuggestions'](_0x49d9cf,'formatInline')){if(!_0x1a5cfd['isOwn'])continue;if(_0x3c7a73['subType']!=_0x5d2630)continue;const _0x2a9572=_0x3c7a73['getFirstRange']();if(_0x2a9572['containsRange'](_0x49d9cf,!0x0))return;_0x2a0ec7=_0x2a0ec7['isBefore'](_0x2a9572['start'])?_0x2a0ec7:_0x2a9572['start'],_0x207cb2=_0x207cb2['isAfter'](_0x2a9572['end'])?_0x207cb2:_0x2a9572['end'],_0x55fb46?_0x2a9572['start']['isBefore'](_0x55fb46['getFirstRange']()['start'])?(_0x55fb46['removeMarkers'](),_0x55fb46=_0x3c7a73):_0x3c7a73['removeMarkers']():_0x55fb46=_0x3c7a73;}const _0x459abe=this['_model']['createRange'](_0x2a0ec7,_0x207cb2);if(_0x55fb46)this['_setSuggestionRange'](_0x55fb46,_0x459abe);else{const _0x5b9830=_0x255215(),_0x1f19ca=_0x5a5885['id'];this['_setSuggestionData']({'id':_0x5b9830,'type':'formatInline:'+_0x5d2630,'data':_0x394e5a,'createdAt':new Date(),'authorId':_0x1f19ca}),this['_addSuggestionMarker']('formatInline:'+_0x5d2630,_0x5b9830,_0x1f19ca,_0x459abe);}}}['markBlockFormat'](_0x4c3f62,_0x599616,_0x1b4518=[],_0x59f4cd=null){_0x599616['formatGroupId']||(_0x599616['formatGroupId']=_0x599616['commandName']),_0x599616['multipleBlocks']=_0x4c3f62 instanceof _0x3f1ec9,_0x59f4cd=_0x59f4cd||kt(_0x599616);const _0x11e93c=_0x1b4518['map'](_0x1e2f31=>yt(_0x1e2f31,this['_model'])),_0x575174=_0x4c3f62 instanceof _0x3f1ec9?_0x4c3f62:yt(_0x4c3f62,this['_model']);_0x11e93c['push'](_0x575174);let _0x14be43=!0x0;for(const _0x12343c of _0x11e93c)if(!this['_rangeIsInLocalUserInsertion'](_0x12343c)){_0x14be43=!0x1;break;}if(_0x14be43)return void this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x59f4cd,'accept')([_0x575174],_0x599616);let _0x2ce217=null,_0x5663fc=_0x575174['start'],_0x234e6a=_0x575174['end'];for(const {suggestion:_0x25f65b,meta:_0xe2d5c0}of this['_findSuggestions'](_0x575174,'formatBlock')){if(!_0xe2d5c0['isOwn']||_0xe2d5c0['isNextTo']||_0xe2d5c0['containsRangeInObject']||_0xe2d5c0['isInsideObject'])continue;if(_0x25f65b['data']['formatGroupId']!=_0x599616['formatGroupId'])continue;const _0x2f3f0e=_0x25f65b['getFirstRange']();if(_0x25f65b['subType']==_0x59f4cd){if(_0x2f3f0e['containsRange'](_0x575174,!0x0))return;_0x5663fc=_0x5663fc['isBefore'](_0x2f3f0e['start'])?_0x5663fc:_0x2f3f0e['start'],_0x234e6a=_0x234e6a['isAfter'](_0x2f3f0e['end'])?_0x234e6a:_0x2f3f0e['end'],_0x2ce217?_0x2f3f0e['start']['isBefore'](_0x2ce217['getFirstRange']()['start'])?(_0x2ce217['removeMarkers'](),_0x2ce217=_0x25f65b):_0x25f65b['removeMarkers']():_0x2ce217=_0x25f65b;}else{const _0x23de26=_0x575174['getIntersection'](_0x2f3f0e);this['_cutOutSuggestionMarker'](_0x25f65b,_0x23de26);}}const _0x2ec890=this['editor']['plugins']['get']('Users')['me'],_0x423c1b=_0x255215(),_0x4646d1=_0x2ec890['id'];_0x2ce217?this['_setSuggestionRange'](_0x2ce217,this['_model']['createRange'](_0x5663fc,_0x234e6a)):(this['_setSuggestionData']({'id':_0x423c1b,'type':'formatBlock:'+_0x59f4cd,'data':_0x599616,'createdAt':new Date(),'authorId':_0x4646d1}),this['_addSuggestionMarker']('formatBlock:'+_0x59f4cd,_0x423c1b,_0x4646d1,this['_model']['createRange'](_0x5663fc,_0x234e6a)));}['markMultiRangeBlockFormat'](_0x33624f,_0x32f2da,_0x16b5b2=[],_0x188aad=null){_0x32f2da['formatGroupId']||(_0x32f2da['formatGroupId']=_0x32f2da['commandName']),_0x32f2da['multipleBlocks']=!0x1,_0x188aad=_0x188aad||kt(_0x32f2da);const _0x23e271=_0x16b5b2['map'](_0x1638ae=>yt(_0x1638ae,this['_model'])),_0x415838=_0x33624f['map'](_0x43c382=>yt(_0x43c382,this['_model']));_0x23e271['push'](..._0x415838);let _0x3b74bf=!0x0;for(const _0x290e1b of _0x23e271)if(!this['_rangeIsInLocalUserInsertion'](_0x290e1b)){_0x3b74bf=!0x1;break;}if(_0x3b74bf)return void this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x188aad,'accept')(_0x415838,_0x32f2da);const _0x108fdb=this['editor']['plugins']['get']('Users')['me'];for(const _0x265c32 of this['getSuggestions']()){if(_0x265c32['author']['id']!=_0x108fdb['id'])continue;if('formatBlock'!=_0x265c32['type']||_0x265c32['data']['formatGroupId']!=_0x32f2da['formatGroupId'])continue;const _0x9bbcf0=_0x265c32['subType']==_0x188aad;for(let _0x19163e=0x0;_0x19163e<_0x415838['length'];_0x19163e++){const _0x378dc0=_0x415838[_0x19163e];for(const _0x42c996 of _0x265c32['getMarkers']()){const _0x159c9d=_0x42c996['getRange']();if(_0x378dc0['isEqual'](_0x159c9d)){_0x9bbcf0?(_0x415838['splice'](_0x19163e,0x1),_0x19163e--):_0x265c32['removeMarker'](_0x42c996['name']);break;}}}}if(0x0==_0x415838['length'])return;const _0x14ba15=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x188aad,'join');for(const _0x5b5595 of this['getSuggestions']())if(_0x5b5595['author']['id']==_0x108fdb['id']&&'formatBlock'==_0x5b5595['type']&&_0x5b5595['data']['formatGroupId']==_0x32f2da['formatGroupId']&&_0x5b5595['subType']==_0x188aad&&(_0x14ba15(_0x5b5595['getRanges'](),_0x415838)||_0x14ba15(_0x415838,_0x5b5595['getRanges']()))){for(const _0xa3d304 of _0x415838)_0x5b5595['addRange'](_0xa3d304);return _0x5b5595;}const _0x3af796=_0x255215(),_0x1c1924=_0x108fdb['id'],_0xb12108='formatBlock:'+_0x188aad,_0x15e4c0=this['_setSuggestionData']({'id':_0x3af796,'type':_0xb12108,'data':_0x32f2da,'createdAt':new Date(),'authorId':_0x1c1924});for(const _0x3035e9 of _0x415838)this['_addSuggestionMarker'](_0xb12108,_0x3af796,_0x1c1924,_0x3035e9,_0x31787d['getMultiRangeId']());return _0x15e4c0;}['markDeletion'](_0x260794,_0x3b0a65=null){if(_0x260794['isCollapsed'])return null;const _0x5ef1e7=this['editor']['plugins']['get']('Users')['me'],_0x2767df=new _0x5d66bd(_0x260794['start'],_0x260794['end']);for(const {suggestion:_0x211679,meta:_0x18615d}of this['_findSuggestions'](_0x2767df,'insertion'))if(_0x18615d['isOwn']&&!_0x18615d['isNextTo']){if(_0x211679['isMultiRange']){const _0x3c68d0=_0x211679['getRanges']();_0x3c68d0['every'](_0xc9ffbe=>_0x2767df['containsRange'](_0xc9ffbe,!0x0))&&_0x211679['discard']();if(_0x3c68d0['some'](_0x5aac56=>_0x5aac56['containsRange'](_0x2767df,!0x0)))return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3b0a65,'accept')([_0x2767df]),null;}else{const _0x535727=_0x2767df['getIntersection'](_0x211679['getFirstRange']());_0x211679['_onDiscard']([_0x535727]);}}if(_0x2767df['detach'](),_0x2767df['isCollapsed']||'$graveyard'==_0x2767df['root']['rootName'])return null;let _0x54a1e7=null,_0x2ef1de=_0x2767df['start'],_0x394fb2=_0x2767df['end'];for(const {suggestion:_0x26fb6e,meta:_0x39c223}of this['_findSuggestions'](_0x2767df,'deletion'))if(_0x39c223['isOwn']){if(_0x26fb6e['isMultiRange']){let _0x4da0a0=!0x0;for(const _0x40e37f of _0x26fb6e['getRanges']()){if(_0x40e37f['containsRange'](_0x2767df,!0x0))return _0x26fb6e;_0x2767df['containsRange'](_0x40e37f)||(_0x4da0a0=!0x1);}_0x4da0a0&&_0x26fb6e['discard']();}else{const _0xc62bec=_0x26fb6e['getFirstRange']();if(_0xc62bec['containsRange'](_0x2767df,!0x0))return _0x26fb6e;_0x2ef1de=_0x2ef1de['isBefore'](_0xc62bec['start'])?_0x2ef1de:_0xc62bec['start'],_0x394fb2=_0x394fb2['isAfter'](_0xc62bec['end'])?_0x394fb2:_0xc62bec['end'],_0x54a1e7?_0xc62bec['start']['isBefore'](_0x54a1e7['getFirstRange']()['start'])?(_0x54a1e7['removeMarkers'](),_0x54a1e7=_0x26fb6e):_0x26fb6e['removeMarkers']():_0x54a1e7=_0x26fb6e;}}if(_0x54a1e7)return this['_setSuggestionRange'](_0x54a1e7,this['_model']['createRange'](_0x2ef1de,_0x394fb2)),_0x54a1e7;{const _0x274444=_0x255215(),_0x3ca8af=this['_model']['createRange'](_0x2ef1de,_0x394fb2),_0x9718e6=_0x5ef1e7['id'],_0x522688=_0x3b0a65?'deletion:'+_0x3b0a65:'deletion',_0x28b11d=this['_setSuggestionData']({'id':_0x274444,'type':_0x522688,'createdAt':new Date(),'authorId':_0x9718e6});return this['_addSuggestionMarker'](_0x522688,_0x274444,_0x9718e6,_0x3ca8af),_0x28b11d;}}['markMultiRangeDeletion'](_0x485260,_0x3526de='multi'){const _0x21faa2=this['editor']['plugins']['get']('Users')['me'],_0x2d7650=_0x485260['map'](_0x4ad0a2=>new _0x5d66bd(_0x4ad0a2['start'],_0x4ad0a2['end'])),_0x2f08ae=new Set();for(const _0x51e791 of _0x2d7650)for(const {suggestion:_0x59921e,meta:_0xa17675}of this['_findSuggestions'](_0x51e791,'insertion'))_0xa17675['isOwn']&&!_0xa17675['isNextTo']&&_0x2f08ae['add'](_0x59921e);for(const _0x261cd1 of _0x2f08ae)if(_0x261cd1['isMultiRange']){const _0x6e973b=_0x261cd1['getRanges']();_0x6e973b['every'](_0x3d00b6=>_0x2d7650['some'](_0x36d7cf=>_0x36d7cf['containsRange'](_0x3d00b6,!0x0)))&&_0x261cd1['discard']();if(_0x2d7650['every'](_0x5e658c=>_0x6e973b['some'](_0x2846ac=>_0x2846ac['containsRange'](_0x5e658c,!0x0))))return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3526de,'accept')(_0x485260),null;}else{const _0x3a19bc=_0x261cd1['getFirstRange']();_0x2d7650['some'](_0x53da21=>_0x53da21['containsRange'](_0x3a19bc,!0x0))&&_0x261cd1['discard']();if(_0x2d7650['every'](_0x523c45=>_0x3a19bc['containsRange'](_0x523c45,!0x0)))return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3526de,'accept')(_0x2d7650),null;}const _0x399d47=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3526de,'join');let _0x260b49=null;for(const _0x3eb568 of this['getSuggestions']())if(_0x3eb568['author']['id']==_0x21faa2['id']&&_0x3eb568['isInContent']&&'deletion'==_0x3eb568['type']&&_0x3eb568['subType']==_0x3526de&&(_0x399d47(_0x3eb568['getRanges'](),_0x485260)||_0x399d47(_0x485260,_0x3eb568['getRanges']()))){if(_0x260b49){if(_0x3eb568['commentThread']&&_0x3eb568['commentThread']['length'])continue;for(const _0xf8afbc of _0x3eb568['getRanges']())_0x260b49['isIntersectingWithRange'](_0xf8afbc)||_0x260b49['addRange'](_0xf8afbc);_0x3eb568['removeMarkers']();}else{_0x260b49=_0x3eb568;for(const _0x4d6649 of _0x485260)_0x3eb568['isIntersectingWithRange'](_0x4d6649)||_0x3eb568['addRange'](_0x4d6649);}}if(_0x260b49)return _0x260b49;_0x2f08ae['clear']();for(const _0x300101 of _0x2d7650)for(const {suggestion:_0x46adde,meta:_0xa1c8b5}of this['_findSuggestions'](_0x300101,'deletion'))_0xa1c8b5['isOwn']&&_0x2f08ae['add'](_0x46adde);for(const _0x52115b of _0x2f08ae){const _0x140779=_0x52115b['getRanges']();if(_0x2d7650['every'](_0x4697b7=>_0x140779['some'](_0x2a490c=>_0x2a490c['containsRange'](_0x4697b7,!0x0))))return _0x52115b;_0x140779['every'](_0x583dd1=>_0x2d7650['some'](_0x54e583=>_0x54e583['containsRange'](_0x583dd1,!0x0)))&&_0x52115b['discard']();}const _0x4619bf=_0x255215(),_0x55bd99=_0x21faa2['id'],_0x1e2f83='deletion:'+_0x3526de,_0x5a17ed=this['_setSuggestionData']({'id':_0x4619bf,'type':_0x1e2f83,'createdAt':new Date(),'authorId':_0x55bd99});for(const _0x32a95e of _0x2d7650)_0x32a95e['detach'](),_0x32a95e['isCollapsed']||'$graveyard'==_0x32a95e['root']['rootName']||this['_addSuggestionMarker'](_0x1e2f83,_0x4619bf,_0x55bd99,_0x32a95e,_0x31787d['getMultiRangeId']());return _0x5a17ed;}['_setSuggestionRange'](_0x2af792,_0xadf158){const _0x498981=_0x2af792['getFirstMarker']();this['_model']['change'](_0x38e271=>{_0x38e271['updateMarker'](_0x498981,{'range':_0xadf158});});}['_addThreadToSuggestion'](_0x4d8b86){const _0x2fff6a=_0x4d8b86['id'],_0x1b68a2=this['editor']['config']['get']('collaboration.channelId');this['_commentsRepository']['hasCommentThread'](_0x2fff6a)||this['_commentsRepository']['addCommentThread']({'channelId':_0x1b68a2,'threadId':_0x2fff6a}),_0x4d8b86['commentThread']=this['_commentsRepository']['getCommentThread'](_0x2fff6a);}['_checkSuggestionCorrectness'](_0x1ec44e,_0x11962c,_0x2e76fd,_0x40a7d9){if(_0x1ec44e['type']!=_0x11962c||_0x1ec44e['subType']!=_0x2e76fd||_0x1ec44e['author']['id']!=_0x40a7d9)throw this['editor']['isReadOnly']=!0x0,new _0x1c9696('track-changes-suggestion-data-mismatch',this);}['_cutOutSuggestionMarker'](_0x38651c,_0xae1dc2){const _0x541a1b=_0x38651c['getFirstRange']();if(_0xae1dc2['isEqual'](_0x541a1b))_0x38651c['removeMarkers']();else{if(_0x541a1b['containsRange'](_0xae1dc2)){const _0x18d72d=this['_model']['createPositionAt'](_0xae1dc2['start']['nodeBefore'],'end');this['_setSuggestionRange'](_0x38651c,this['_model']['createRange'](_0x541a1b['start'],_0x18d72d));const _0x7a3452=_0x255215(),_0x3c5a91=_0x38651c['author']['id'],_0x41b598=_0x38651c['type']+':'+_0x38651c['subType'];this['_setSuggestionData']({'id':_0x7a3452,'type':_0x41b598,'createdAt':new Date(),'authorId':_0x3c5a91,'data':_0x38651c['data']});const _0x213f5a=this['_model']['createPositionAt'](_0xae1dc2['end']['parent'],'after'),_0x135891=this['_model']['createRange'](_0x213f5a,_0x541a1b['end']);this['_addSuggestionMarker'](_0x41b598,_0x7a3452,_0x3c5a91,_0x135891);}else{if(_0x541a1b['containsPosition'](_0xae1dc2['start'])){const _0x2f5921=this['_model']['createPositionAt'](_0xae1dc2['start']['nodeBefore'],'end');this['_setSuggestionRange'](_0x38651c,this['_model']['createRange'](_0x541a1b['start'],_0x2f5921));}else{const _0x222ade=this['_model']['createPositionAt'](_0xae1dc2['end']['parent'],'after');this['_setSuggestionRange'](_0x38651c,this['_model']['createRange'](_0x222ade,_0x541a1b['end']));}}}}['_rangeIsInLocalUserInsertion'](_0x420831){for(const {suggestion:_0x52d45e,meta:_0x2e5670}of this['_findSuggestions'](_0x420831,'insertion')){if(!_0x2e5670['isOwn'])continue;const _0x17e86c=_0x52d45e['getRanges']();for(const _0x354ccd of _0x17e86c)if(!_0x420831['getDifference'](_0x354ccd)['length'])return!0x0;}return!0x1;}['_getAuthorFromId'](_0x428bea){const _0x2d62a0=this['editor']['plugins']['get']('Users')['getUser'](_0x428bea);if(!_0x2d62a0)throw new _0x1c9696('track-changes-user-not-found',this);return _0x2d62a0;}['_createSuggestion'](_0x399f37,_0x1986c0,_0x3a9d63,_0x38efb9){const _0x5d9984=this['_getAuthorFromId'](_0x38efb9),_0x385f0e=this['_suggestionFactory']['buildSuggestion'](_0x399f37,_0x1986c0,_0x3a9d63,_0x5d9984);return this['listenTo'](_0x385f0e,'accept',()=>{this['_updateSuggestionData'](_0x3a9d63,{'state':'accepted'});},{'priority':'high'}),this['listenTo'](_0x385f0e,'discard',()=>{this['_updateSuggestionData'](_0x3a9d63,{'state':'rejected'});},{'priority':'high'}),this['_suggestions']['set'](_0x3a9d63,_0x385f0e),this['_suggestionState']['set'](_0x385f0e,'notReady'),_0x385f0e;}['_splitMarkerName'](_0x365a4d){const _0x3687e4=_0x365a4d['split'](':');return{'group':_0x3687e4[0x0],'type':_0x3687e4[0x1],'subType':_0x3687e4['length']>=0x5?_0x3687e4[0x2]:null,'id':_0x3687e4['length']<0x5?_0x3687e4[0x2]:_0x3687e4[0x3],'authorId':_0x3687e4['length']<0x5?_0x3687e4[0x3]:_0x3687e4[0x4],'markerCount':0x6==_0x3687e4['length']?_0x3687e4[0x5]:null};}['_breakSuggestionMarker'](_0x14947a,_0x197bf7,_0x347ce4){const _0x2dbad9=_0x14947a['getFirstRange'](),_0x3894b1=_0x2dbad9['start'],_0x4ed7c9=_0x2dbad9['end'];this['_setSuggestionRange'](_0x14947a,this['_model']['createRange'](_0x3894b1,_0x197bf7));const _0x3a70cc=_0x255215(),_0x19b5a2=_0x14947a['author']['id'],_0x505ae9=_0x14947a['type']+(_0x14947a['subType']?':'+_0x14947a['subType']:'');this['_setSuggestionData']({'id':_0x3a70cc,'type':_0x505ae9,'createdAt':new Date(),'authorId':_0x19b5a2,'originalSuggestionId':_0x14947a['id'],'data':_0x14947a['data']}),'formatBlock'==_0x14947a['type']&&(_0x347ce4=this['_model']['createPositionBefore'](_0x347ce4['parent'])),this['_addSuggestionMarker'](_0x505ae9,_0x3a70cc,_0x19b5a2,this['_model']['createRange'](_0x347ce4,_0x4ed7c9));}['_findSuggestions'](_0x104768,_0x532291=null){const _0x45b8fd=[],_0x51649d=this['_model']['schema'],_0xd2167a=this['editor']['plugins']['get']('Users')['me'];for(const _0x50ef28 of this['getSuggestions']())if(_0x50ef28['isInContent']&&(!_0x532291||_0x50ef28['type']==_0x532291))for(const _0x4fe0fb of _0x50ef28['getRanges']()){const _0x5470a1=_0x104768['start']['isEqual'](_0x4fe0fb['end'])||_0x104768['end']['isEqual'](_0x4fe0fb['start']);if(_0x5470a1||_0x104768['getIntersection'](_0x4fe0fb)){const _0x5f03f0=_0x104768['containsRange'](_0x4fe0fb)&&lt(_0x51649d,_0x4fe0fb['start'],_0x104768),_0x4bbcfc=_0x4fe0fb['containsRange'](_0x104768)&&lt(_0x51649d,_0x104768['start'],_0x4fe0fb);_0x45b8fd['push']({'suggestion':_0x50ef28,'meta':{'isOwn':_0xd2167a==_0x50ef28['author'],'isNextTo':_0x5470a1,'isInsideObject':_0x5f03f0,'containsRangeInObject':_0x4bbcfc}});break;}}return _0x45b8fd;}['_addSuggestionMarker'](_0x30880b,_0x232a41,_0x61bff8,_0x5c9871,_0x32a239=null){this['_model']['change'](_0x41e5de=>{let _0x3e8778='suggestion:'+_0x30880b+':'+_0x232a41+':'+_0x61bff8;_0x32a239&&(_0x3e8778=_0x3e8778+':'+_0x32a239),_0x41e5de['addMarker'](_0x3e8778,{'range':_0x5c9871,'usingOperation':!0x0,'affectsData':!0x0});});}['_removeSuggestion'](_0x6317a){const _0x59cb81=_0x6317a['previous'],_0x3a5585=_0x6317a['next'];_0x6317a['previous']=null,null!=_0x59cb81&&(_0x59cb81['next']=null),_0x6317a['next']=null,'ready'==this['_suggestionState']['get'](_0x6317a)&&(this['_suggestionState']['set'](_0x6317a,'removed'),this['fire']('suggestionUnloaded',_0x6317a,_0x59cb81,_0x3a5585)),null!=_0x3a5585&&(_0x3a5585['previous']=null);}['_setSuggestionData'](_0x3ea7e3){const _0x1f1426=_0x3ea7e3['id'],_0x572aaa=this['addSuggestionData'](_0x3ea7e3);if(this['_adapter']&&this['_adapter']['addSuggestion']){const _0x479132=this['editor']['plugins']['get']('PendingActions'),_0x57ff86=_0x572aaa['hasComments'],_0x32657b=_0x572aaa['subType']?_0x572aaa['type']+':'+_0x572aaa['subType']:_0x572aaa['type'],t=this['editor']['locale']['t'],_0x5f0589=_0x479132['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'})),_0x2b2408={'id':_0x1f1426,'type':_0x32657b,'hasComments':_0x57ff86,'data':_0x3ea7e3['data']||null,'originalSuggestionId':_0x3ea7e3['originalSuggestionId']||null};this['_adapter']['addSuggestion'](_0x2b2408)['then'](_0x10b3cd=>{_0x479132['remove'](_0x5f0589),_0x10b3cd&&_0x10b3cd['createdAt']&&(this['_suggestions']['get'](_0x1f1426)['createdAt']=_0x10b3cd['createdAt']);});}return _0x572aaa;}['_updateSuggestionData'](_0x5acc35,_0x5e2637){const _0x54a8eb=this['editor']['plugins']['get']('PendingActions');if(this['_adapter']&&this['_adapter']['updateSuggestion']){const t=this['editor']['locale']['t'],_0x5ed315=_0x54a8eb['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'}));this['_adapter']['updateSuggestion'](_0x5acc35,_0x5e2637)['then'](()=>{_0x54a8eb['remove'](_0x5ed315);});}}['_getSuggestionData'](_0x549b28){if(!this['_adapter']||!this['_adapter']['getSuggestion'])throw new _0x1c9696('track-changes-adapter-missing-getsuggestion',this);return this['_adapter']['getSuggestion'](_0x549b28);}['_handleNewSuggestionMarker'](_0x1f95b3){const {id:_0x33c2ed,type:_0x181f12,subType:_0x40b5b3,authorId:_0x20f5c4}=this['_splitMarkerName'](_0x1f95b3),_0x51353f=this['_suggestions']['get'](_0x33c2ed)||this['_createSuggestion'](_0x181f12,_0x40b5b3,_0x33c2ed,_0x20f5c4);switch(this['_checkSuggestionCorrectness'](_0x51353f,_0x181f12,_0x40b5b3,_0x20f5c4),this['_suggestionState']['get'](_0x51353f)){case'notReady':this['_getSuggestionData'](_0x33c2ed)['then'](_0x2fba47=>{let _0x2904c4=Promise['resolve']();_0x2fba47['hasComments']&&(_0x2904c4=this['_commentsRepository']['fetchCommentThread']({'channelId':this['editor']['config']['get']('collaboration.channelId'),'threadId':_0x33c2ed})),_0x2904c4['then'](()=>{this['addSuggestionData'](_0x2fba47);});}),this['_suggestionState']['set'](_0x51353f,'markerReady');break;case'removed':this['_updateSuggestionData'](_0x33c2ed,{'state':'open'});case'dataReady':this['_suggestionState']['set'](_0x51353f,'ready'),this['fire']('suggestionLoaded',_0x51353f);break;case'ready':this['fire']('suggestionChanged',_0x51353f);}_0x51353f['addMarkerName'](_0x1f95b3),this['_refreshSuggestionsChain'](_0x51353f);}['_refreshSuggestionsChain'](_0x52c6bd){if('formatInline'==_0x52c6bd['type']||'formatBlock'==_0x52c6bd['type'])return;if(_0x52c6bd['isMultiRange'])return;let _0x643f3b=!0x0;for(const _0xb6e0af of this['getSuggestions']())if(!_0xb6e0af['isMultiRange']&&_0xb6e0af!=_0x52c6bd&&_0xb6e0af['isInContent']&&'formatInline'!=_0xb6e0af['type']&&'formatBlock'!=_0xb6e0af['type']&&_0xb6e0af['author']['id']==_0x52c6bd['author']['id']){if(this['_canChainSuggestions'](_0xb6e0af,_0x52c6bd)){if(_0x52c6bd['commentThread']&&_0x52c6bd['commentThread']['length'])continue;_0xb6e0af['next']=_0x52c6bd,_0x52c6bd['previous']=_0xb6e0af,_0x643f3b=!0x1;}if(this['_canChainSuggestions'](_0x52c6bd,_0xb6e0af)){if(_0xb6e0af['commentThread']&&_0xb6e0af['commentThread']['length'])continue;_0x52c6bd['next']=_0xb6e0af,_0xb6e0af['previous']=_0x52c6bd;}}_0x52c6bd['previous']&&_0x643f3b&&(_0x52c6bd['previous']['next']=null,_0x52c6bd['previous']=null);}['_canChainSuggestions'](_0x55b534,_0x55409d){const _0x42ae6c=_0x55b534['getFirstRange'](),_0x387a57=_0x55409d['getFirstRange']();if(_0x42ae6c['end']['isEqual'](_0x387a57['start']))return!0x0;if(_0x55b534['type']!=_0x55409d['type'])return!0x1;if(!_0x42ae6c['end']['isTouching'](_0x387a57['start']))return!0x1;const _0x1f4301=new _0x3a2bc4({'boundaries':this['editor']['model']['createRange'](_0x42ae6c['end'],_0x387a57['start'])});for(const _0xe1a68 of _0x1f4301)if('elementEnd'==_0xe1a68['type']&&this['editor']['model']['schema']['isLimit'](_0xe1a68['item']))return!0x1;return!0x0;}['_joinWithAdjacentSuggestions'](_0x57fda9){for(const _0x1caf52 of this['_suggestions']['values']()){if(_0x1caf52==_0x57fda9||!_0x1caf52['isInContent'])continue;if(_0x1caf52['type']!=_0x57fda9['type']||_0x1caf52['author']['id']!=_0x57fda9['author']['id']||_0x1caf52['subType']!=_0x57fda9['subType'])continue;const _0x51bce8=this['_suggestionFactory']['getSuggestionCallback'](_0x57fda9['type'],_0x57fda9['subType'],'join');if(_0x51bce8(_0x1caf52['getRanges'](),_0x57fda9['getRanges']())){if(_0x57fda9['commentThread']&&_0x57fda9['commentThread']['length'])continue;return this['_joinSuggestions'](_0x1caf52,_0x57fda9),!0x0;}if(_0x51bce8(_0x57fda9['getRanges'](),_0x1caf52['getRanges']())){if(_0x1caf52['commentThread']&&_0x1caf52['commentThread']['length'])continue;return this['_joinSuggestions'](_0x57fda9,_0x1caf52),!0x0;}}return!0x1;}['_joinSuggestions'](_0x1a630c,_0xa4743a){if(_0x1a630c['isMultiRange'])for(const _0x2d5250 of _0xa4743a['getRanges']())_0x1a630c['addRange'](_0x2d5250);else{const _0x7a5c5b=_0xa4743a['getFirstRange']()['end'];this['_setSuggestionRange'](_0x1a630c,this['_model']['createRange'](_0x1a630c['getFirstRange']()['start'],_0x7a5c5b));}_0xa4743a['removeMarkers']();}}_0xd082e5(u,_0x29e645);class mt{constructor(_0x20c9c7){this['_editor']=_0x20c9c7,this['_model']=_0x20c9c7['model'],this['_customCallbacks']=new Map(),this['_defaultCallbacks']=new Map(),this['_registerDefaultCallbacks']();}['buildSuggestion'](_0x1cd5e1,_0x111bb0,_0x179add,_0x5241fa){return new _0x31787d(this['_model'],{'type':_0x1cd5e1,'subType':_0x111bb0,'id':_0x179add,'author':_0x5241fa,'onAccept':(..._0x5c6717)=>this['getSuggestionCallback'](_0x1cd5e1,_0x111bb0,'accept')(..._0x5c6717),'onDiscard':(..._0x339637)=>this['getSuggestionCallback'](_0x1cd5e1,_0x111bb0,'discard')(..._0x339637)});}['registerCustomCallback'](_0x1024fe,_0x266eb8,_0x3c9115,_0x13011c){const _0x35337d=_0x1024fe+':'+_0x266eb8+':'+_0x3c9115;this['_customCallbacks']['set'](_0x35337d,_0x13011c);}['getSuggestionCallback'](_0xcad4db,_0x3666c9,_0x3561e3){const _0x250fe7=_0xcad4db+':'+_0x3666c9+':'+_0x3561e3;return this['_customCallbacks']['get'](_0x250fe7)||this['_defaultCallbacks']['get'](_0xcad4db+':'+_0x3561e3);}['_registerDefaultCallbacks'](){const _0x3354c5=()=>{},_0x35a1ee=_0x64cc1b=>{_0x64cc1b['sort']((_0x1717af,_0x16b8ef)=>_0x1717af['start']['isBefore'](_0x16b8ef['start'])?0x1:-0x1),this['_model']['change'](_0x281d10=>{for(const _0x266703 of _0x64cc1b){let _0x26a225;_0x26a225=_0x266703['end']['isAtEnd']&&_0x266703['end']['parent']==_0x266703['start']['nodeAfter']?_0x281d10['createSelection'](_0x266703['start']['nodeAfter'],'on'):_0x281d10['createSelection'](_0x266703),this['_model']['deleteContent'](_0x26a225,{'forceDefaultExecution':!0x0,'doNotAutoparagraph':!0x0});}});},_0x10a98b=(_0x156440,_0x57c3fe)=>{this['_model']['change'](_0x2379ad=>{const {commandName:_0x430bbd,commandParams:_0x460366}=_0x57c3fe,_0x5ab37d=_0x156440[0x0];if('$graveyard'==_0x5ab37d['root']['rootName'])return;const _0x5a05f9=Array['from'](this['_model']['document']['selection']['getRanges']())['map'](_0x1b1a00=>_0x5d66bd['fromRange'](_0x1b1a00));var _0x198b2c;(_0x198b2c=_0x5ab37d)['end']['parent']==_0x198b2c['start']['nodeAfter']&&0x0==_0x198b2c['end']['offset']?_0x2379ad['setSelection'](this['_model']['createRange'](_0x5ab37d['end'])):_0x2379ad['setSelection'](_0x5ab37d),this['_editor']['commands']['get'](_0x430bbd)['refresh'](),_0x460366['push']({'forceDefaultExecution':!0x0}),this['_editor']['execute'](_0x430bbd,..._0x460366);const _0xcb5f12=_0x5a05f9['filter'](_0x1d9b15=>'$graveyard'!=_0x1d9b15['root']['rootName']);_0xcb5f12['length']>0x0&&_0x2379ad['setSelection'](_0xcb5f12);for(const _0x22f46f of _0x5a05f9)_0x22f46f['detach']();});},_0x909e64=(_0x4379b1,_0x426830)=>0x1==_0x4379b1['length']&&0x1==_0x426830['length']&&_0x4379b1[0x0]['end']['isEqual'](_0x426830[0x0]['start']);this['_defaultCallbacks']['set']('insertion:accept',_0x3354c5),this['_defaultCallbacks']['set']('insertion:discard',_0x35a1ee),this['_defaultCallbacks']['set']('insertion:join',_0x909e64),this['_defaultCallbacks']['set']('deletion:accept',_0x35a1ee),this['_defaultCallbacks']['set']('deletion:discard',_0x3354c5),this['_defaultCallbacks']['set']('deletion:join',_0x909e64),this['_defaultCallbacks']['set']('formatInline:accept',_0x10a98b),this['_defaultCallbacks']['set']('formatInline:discard',_0x3354c5),this['_defaultCallbacks']['set']('formatInline:join',_0x909e64),this['_defaultCallbacks']['set']('formatBlock:accept',_0x10a98b),this['_defaultCallbacks']['set']('formatBlock:discard',_0x3354c5),this['_defaultCallbacks']['set']('formatBlock:join',_0x909e64);}}function lt(_0x15c640,_0x5e57db,_0x2a753f){for(const _0xa6387c of _0x5e57db['parent']['getAncestors']({'includeSelf':!0x0,'parentFirst':!0x0})){if(_0xa6387c['root']==_0xa6387c)return!0x1;if(!_0x2a753f['containsItem'](_0xa6387c))return!0x1;if(_0x15c640['isObject'](_0xa6387c)||_0x15c640['isLimit'](_0xa6387c))return!0x0;}}function pt(_0x271456,_0x249f5f,_0x130224,_0xe06c12){const _0x4dc75e=_0x271456['start']['getLastMatchingPosition'](_0x381caa=>!_0x381caa['item']['is']('textProxy')&&!_0xe06c12['isObject'](_0x381caa['item'])),_0x3efe75=_0x271456['end']['getLastMatchingPosition'](_0x63cec8=>!_0x63cec8['item']['is']('textProxy')&&!_0xe06c12['isObject'](_0x63cec8['item']),{'direction':'backward'});if(!_0x271456['start']['isEqual'](_0x4dc75e)||!_0x271456['end']['isEqual'](_0x3efe75)){const _0x390526=_0x130224['createRange'](_0x4dc75e,_0x3efe75);return _0x130224['updateMarker'](_0x249f5f,{'range':_0x390526}),!0x0;}return!0x1;}function kt(_0x9dd40f){return dt(_0x9dd40f);}function wt(_0xdc42e1){const _0x647d42=_0xdc42e1['start']['nodeAfter'];return _0x647d42&&_0x647d42['is']('element');}function yt(_0x4334d5,_0x5a5f4f){const _0x527b94=_0x5a5f4f['schema']['isObject'](_0x4334d5)||_0x5a5f4f['schema']['isSelectable'](_0x4334d5);return _0x5a5f4f['createRange'](_0x5a5f4f['createPositionAt'](_0x4334d5,'before'),_0x527b94?_0x5a5f4f['createPositionAfter'](_0x4334d5):_0x5a5f4f['createPositionAt'](_0x4334d5,'end'));}