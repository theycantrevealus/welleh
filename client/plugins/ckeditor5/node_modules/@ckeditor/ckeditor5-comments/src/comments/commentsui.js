/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0xc1d411 from'@ckeditor/ckeditor5-core/src/plugin';import _0x1e6b28 from'../annotations/annotations';import _0x1577be from'./commentsrepository';import _0x18d3d2 from'./commentsediting';import _0x5f510b from'../annotations/editorannotations';import _0x2e851e from'@ckeditor/ckeditor5-ui/src/button/buttonview';import _0x27d7cf from'../../theme/icons/add-comment.svg';export default class e extends _0xc1d411{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x1e6b28,_0x1577be,_0x18d3d2,_0x5f510b];}['init'](){const _0x4dc41f=this['editor'],_0x1bcd66=_0x4dc41f['plugins']['get']('CommentsRepository'),_0x2ea2d2=_0x4dc41f['plugins']['get']('CommentsEditing'),_0x3281ee=_0x4dc41f['plugins']['get']('Annotations'),_0xb366c6=_0x4dc41f['plugins']['get']('EditorAnnotations');_0x4dc41f['ui']['componentFactory']['add']('comment',()=>this['_createUIButton']()),_0xb366c6['addSourceCollector'](()=>{const _0x1e8f99=[];for(const [_0x5265b5,_0x1f20be]of _0x1bcd66['_threadToController']){const _0x166865=_0x2ea2d2['getAllMarkersForId'](_0x5265b5['id']),_0x3f7055=_0x166865['map'](_0x27283=>_0x27283['getRange']());_0x166865['length']>0x0&&_0x1e8f99['push']([_0x1f20be['view'],_0x3f7055]);}return _0x1e8f99;}),this['listenTo'](_0x3281ee,'change:activeView',(_0x42a123,_0x940a91,_0x509d19)=>{if(!_0x1bcd66['_viewToController']['has'](_0x509d19))return void(_0x2ea2d2['activeMarker']=null);const _0x433d62=_0x1bcd66['_viewToController']['get'](_0x509d19)['model']['id'],_0x507206='comment:'+_0x433d62;_0x2ea2d2['hasMarkerForId'](_0x433d62)&&_0x2ea2d2['activeMarker']!=_0x507206?_0x2ea2d2['activeMarker']=_0x507206:_0x2ea2d2['activeMarker']&&(_0x2ea2d2['activeMarker']=null);}),this['listenTo'](_0x1bcd66,'removeCommentThread',(_0x5b672f,{threadId:_0x3f3f04,isFromAdapter:_0x508616})=>{!_0x508616&&_0x4dc41f['ui']['focusTracker']['isFocused']&&_0x2ea2d2['hasMarkerForId'](_0x3f3f04)&&_0x4dc41f['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x1bcd66,'addComment',(_0x2e63a9,{threadId:_0x803e30,isFromAdapter:_0x15734d})=>{if(_0x15734d||!_0x2ea2d2['hasMarkerForId'](_0x803e30)||!_0x1bcd66['hasCommentThread'](_0x803e30))return;0x1===_0x1bcd66['getCommentThread'](_0x803e30)['length']&&(_0x4dc41f['editing']['view']['focus'](),_0x2e63a9['stop']());},{'priority':'low'});}['_createUIButton'](){const _0xa1e0cf=this['editor'],_0x36f379=new _0x2e851e(_0xa1e0cf['locale']),_0x86df86=_0xa1e0cf['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x36f379['label']=t('Comment'),_0x36f379['tooltip']=t('Comment'),_0x36f379['icon']=_0x27d7cf,_0x36f379['bind']('isEnabled')['to'](_0x86df86),this['listenTo'](_0x36f379,'execute',()=>_0x86df86['execute']()),_0x36f379;}}