/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x17be=['change','once','high','dataToMarker','from','_detachCommentThread','split','change:isThreadsLoadingPaused','switchReadOnly','update:comment','hasCommentThread','config','upcast','has','hasMarkerForId','data','then','length','fetchCommentThread','low','managedUsingOperations','document','editor','createRange','CommentsRepository','$graveyard','addCommentThread','delete','pluginName','$marker','openNewCommentThread','isObject','removeMarker','_initializeMarkerConverters','top','_handleMarkerAddAndRemove','model','attachTo','left','createPositionBefore','_attachedThreads','collaboration.channelId','start','CommentsEditing','add','size','dataDowncast','get','comment','updateMarker','getWalker','_threads','end','elementToElement','rootName','editing','comment:','ck-comment-marker','getAllMarkersForId','markerName','activeMarker','hasContent','getMarkersGroup','isCollapsed','isThreadsLoadingPaused','push','text','conversion','change:isReadOnly','plugins','editingDowncast','name','ready','set','render','newRange','markers','_attachThreadToMarker','getCommentThread','markerToHighlight','addComment','sort','destroy','removeCommentThread','isEqual','listenTo','getAttribute','for'];(function(_0x3251d1,_0x17be86){const _0x43d938=function(_0x4b601f){while(--_0x4b601f){_0x3251d1['push'](_0x3251d1['shift']());}};_0x43d938(++_0x17be86);}(_0x17be,0x137));const _0x43d9=function(_0x3251d1,_0x17be86){_0x3251d1=_0x3251d1-0x0;let _0x43d938=_0x17be[_0x3251d1];return _0x43d938;};import _0x6c2ae from'@ckeditor/ckeditor5-core/src/plugin';import _0x568cac from'@ckeditor/ckeditor5-utils/src/dom/rect';import _0x28c8c4 from'./commentsrepository';import _0x44718f from'./addcommentthreadcommand';import _0x3f9032 from'../utils/getmarkerdomelement';import _0x2fe52e from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x6c2ae{static get['requires'](){return[_0x28c8c4,_0x2fe52e];}static get[_0x43d9('0x45')](){return _0x43d9('0x54');}constructor(_0x1f38da){super(_0x1f38da),this[_0x43d9('0x1a')](_0x43d9('0x11'),!0x0),_0x1f38da[_0x43d9('0x38')][_0x43d9('0x2a')](_0x43d9('0x19'),()=>this[_0x43d9('0x11')]=!0x1),this['set']('activeMarker',null),this['on']('change:activeMarker',(_0xff1661,_0x3e739e,_0x5482ae,_0x53d882)=>{_0x1f38da['model'][_0x43d9('0x29')](_0x92f466=>{if(_0x5482ae){const {id:_0x1e32b4}=q(_0x5482ae),_0x2e317c=this['getAllMarkersForId'](_0x1e32b4);for(const _0x387ae2 of _0x2e317c)_0x92f466[_0x43d9('0x2')](_0x387ae2);}if(_0x53d882){const {id:_0x2d307b}=q(_0x53d882),_0x3d33f7=this['getAllMarkersForId'](_0x2d307b);for(const _0x373fa7 of _0x3d33f7)_0x92f466[_0x43d9('0x2')](_0x373fa7);}});}),this['_attachedThreads']=new Set();}['init'](){const _0x15e249=this[_0x43d9('0x3f')],_0x478d0b=_0x15e249[_0x43d9('0x16')]['get']('CommentsRepository'),_0x550539=_0x15e249[_0x43d9('0x34')][_0x43d9('0x0')](_0x43d9('0x52'));_0x15e249['commands'][_0x43d9('0x55')](_0x43d9('0x43'),new _0x44718f(_0x15e249)),this['listenTo'](_0x15e249,_0x43d9('0x15'),(_0x499e27,_0x43ced5,_0xd12007)=>{_0x478d0b[_0x43d9('0x31')](_0xd12007,_0x15e249['config'][_0x43d9('0x0')]('collaboration.channelId'));}),this[_0x43d9('0x26')](_0x478d0b,F(_0x43d9('0x24'),_0x550539),(_0x1abf53,{threadId:_0x998f11})=>{_0x15e249['model'][_0x43d9('0x29')](_0xb9b105=>{for(const _0x238653 of this[_0x43d9('0xb')](_0x998f11))_0xb9b105[_0x43d9('0x49')](_0x238653);});const _0x3a2221=_0x478d0b[_0x43d9('0x1f')](_0x998f11);_0x478d0b[_0x43d9('0x33')](_0x998f11)&&!_0x3a2221[_0x43d9('0x3a')]||_0x1abf53['stop']();},{'priority':_0x43d9('0x2b')}),this['listenTo'](_0x478d0b,F(_0x43d9('0x21'),_0x550539),(_0x469213,{threadId:_0x171130,isFromAdapter:_0x2619f8})=>{const _0xca5c8=this['getAllMarkersForId'](_0x171130);if(_0x2619f8||0x0==_0xca5c8[_0x43d9('0x3a')]||!_0x478d0b[_0x43d9('0x33')](_0x171130))return;0x1===_0x478d0b['getCommentThread'](_0x171130)['length']&&_0x15e249[_0x43d9('0x4d')][_0x43d9('0x29')](_0x3f1f71=>{for(const _0x3443bf of _0xca5c8)_0x3f1f71['updateMarker'](_0x3443bf,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':'low'}),this[_0x43d9('0x4a')](),this[_0x43d9('0x4c')]();}[_0x43d9('0x23')](){const _0x11cd96=this[_0x43d9('0x3f')][_0x43d9('0x16')]['get'](_0x43d9('0x41')),_0x37ef52=this[_0x43d9('0x3f')][_0x43d9('0x34')][_0x43d9('0x0')](_0x43d9('0x52'));for(const _0xaebcd5 of _0x11cd96['getCommentThreads']({'channelId':_0x37ef52}))_0x11cd96[_0x43d9('0x2e')](_0xaebcd5['id']),_0x11cd96[_0x43d9('0x4')][_0x43d9('0x44')](_0xaebcd5['id']);super[_0x43d9('0x23')]();}[_0x43d9('0x37')](_0x11772a){return this[_0x43d9('0xb')](_0x11772a)[_0x43d9('0x3a')]>0x0;}[_0x43d9('0xb')](_0x10f7c8){const _0x1f9d8e=this[_0x43d9('0x3f')][_0x43d9('0x4d')]['markers']['get'](_0x43d9('0x9')+_0x10f7c8);return _0x1f9d8e?[_0x1f9d8e]:Array[_0x43d9('0x2d')](this['editor'][_0x43d9('0x4d')][_0x43d9('0x1d')][_0x43d9('0xf')](_0x43d9('0x9')+_0x10f7c8));}[_0x43d9('0x4a')](){const _0x573091=this['editor'];_0x573091[_0x43d9('0x14')][_0x43d9('0x28')](_0x43d9('0x17'))[_0x43d9('0x20')]({'model':_0x43d9('0x1'),'view':_0xe53fac=>{const {id:_0x30aadd}=q(_0xe53fac[_0x43d9('0xc')]),_0x145f44=[_0x43d9('0xa')];return this[_0x43d9('0xd')]&&q(this[_0x43d9('0xd')])['id']===_0x30aadd&&_0x145f44[_0x43d9('0x12')]('ck-comment-marker--active'),{'classes':_0x145f44,'attributes':{'data-comment':_0x30aadd}};}}),_0x573091[_0x43d9('0x14')][_0x43d9('0x28')](_0x43d9('0x57'))['markerToData']({'model':'comment','view':_0x2ecde8=>{const _0x255108=_0x573091[_0x43d9('0x4d')]['markers']['get'](_0x2ecde8),{id:_0x16abae,part:_0x36be21}=q(_0x2ecde8);return _0x255108['affectsData']?{'group':_0x43d9('0x1'),'name':_0x36be21?_0x16abae+':'+_0x36be21:_0x16abae}:null;}}),_0x573091[_0x43d9('0x14')][_0x43d9('0x28')](_0x43d9('0x35'))[_0x43d9('0x6')]({'view':{'name':'comment','attribute':{'id':/^\w/}},'model':(_0xb837c6,{writer:_0xa85181})=>_0xa85181['createElement'](_0x43d9('0x46'),{'data-name':_0x43d9('0x9')+_0xb837c6[_0x43d9('0x27')]('id')})}),_0x573091[_0x43d9('0x14')][_0x43d9('0x28')](_0x43d9('0x35'))[_0x43d9('0x2c')]({'view':'comment'});}['_handleMarkerAddAndRemove'](){const _0x180d7f=this[_0x43d9('0x3f')],_0x3a2e09=_0x180d7f[_0x43d9('0x16')][_0x43d9('0x0')]('CommentsRepository'),_0x2c04e3=new Set();_0x180d7f[_0x43d9('0x4d')][_0x43d9('0x3e')]['registerPostFixer'](_0xaaa17b=>{let _0x44bed2=!0x1;for(const [_0x56c423,_0x5bbc2c]of _0x180d7f[_0x43d9('0x4d')][_0x43d9('0x3e')]['differ']['_changedMarkers']){const {group:_0x5cae03,id:_0x2cfce6}=q(_0x56c423);let _0x3a99d5=_0x5bbc2c[_0x43d9('0x1c')];if('comment'!==_0x5cae03||!_0x3a99d5)continue;const _0xe16d92=_0x43d9('0x42')===_0x3a99d5['root'][_0x43d9('0x7')];_0xe16d92||(_0x3a99d5=z(_0x3a99d5,_0x180d7f[_0x43d9('0x4d')]),!_0x3a99d5||_0x3a99d5[_0x43d9('0x25')](_0x5bbc2c[_0x43d9('0x1c')]))?!_0x3a99d5||!_0x180d7f[_0x43d9('0x4d')][_0x43d9('0xe')](_0x3a99d5)||this['_attachedThreads']['has'](_0x2cfce6)&&_0xe16d92?(_0xaaa17b['removeMarker'](_0x56c423),_0x44bed2=!0x0):_0xe16d92||(this[_0x43d9('0x11')]?_0x2c04e3[_0x43d9('0x55')](_0x2cfce6):this[_0x43d9('0x1e')](_0x2cfce6)):(_0xaaa17b[_0x43d9('0x2')](_0x56c423,{'range':_0x3a99d5}),_0x44bed2=!0x0);}return _0x44bed2;}),this['on'](_0x43d9('0x30'),(_0x5314ba,_0x29c6e,_0x2ee9f9)=>{if(!_0x2ee9f9&&_0x2c04e3[_0x43d9('0x56')])for(const _0x3673b0 of _0x2c04e3)this['_attachThreadToMarker'](_0x3673b0),_0x2c04e3[_0x43d9('0x44')](_0x3673b0);}),this[_0x43d9('0x26')](_0x180d7f[_0x43d9('0x4d')]['markers'],_0x43d9('0x32'),(_0x23dd0a,_0x17216c,_0x37c529,_0x1e394d)=>{if(_0x1e394d)return;const {id:_0x172e80}=q(_0x17216c[_0x43d9('0x18')]),_0x24d9e5=_0x180d7f['plugins'][_0x43d9('0x0')](_0x43d9('0x41'))['getCommentThread'](_0x172e80);_0x2c04e3['delete'](_0x172e80),_0x24d9e5&&!this['hasMarkerForId'](_0x172e80)&&(this[_0x43d9('0x51')][_0x43d9('0x44')](_0x172e80),_0x3a2e09[_0x43d9('0x2e')](_0x172e80));});}[_0x43d9('0x1e')](_0x1e0022){if(this[_0x43d9('0x51')][_0x43d9('0x36')](_0x1e0022))return;this[_0x43d9('0x51')][_0x43d9('0x55')](_0x1e0022);const _0x20118e=this[_0x43d9('0x3f')],_0x451f1a=_0x20118e[_0x43d9('0x16')][_0x43d9('0x0')](_0x43d9('0x41')),_0x1a79fa=_0x20118e[_0x43d9('0x34')]['get'](_0x43d9('0x52')),_0x8923d9=()=>{const _0x2a31a3=this['getAllMarkersForId'](_0x1e0022);if(0x0==_0x2a31a3[_0x43d9('0x3a')])return null;const _0x5312fb=_0x2a31a3['map'](_0x5454e0=>_0x3f9032(_0x20118e['editing'],_0x5454e0));return _0x5312fb[_0x43d9('0x22')]((_0x43c20c,_0x3af725)=>{const _0x4c8c98=new _0x568cac(_0x43c20c),_0x413ba5=new _0x568cac(_0x3af725),_0x5efbf9=_0x4c8c98[_0x43d9('0x4b')]-_0x413ba5['top'];return 0x0==_0x5efbf9?_0x4c8c98['left']-_0x413ba5[_0x43d9('0x4f')]:_0x5efbf9;}),_0x5312fb[0x0];};!this[_0x43d9('0xb')](_0x1e0022)[0x0][_0x43d9('0x3d')]?_0x20118e[_0x43d9('0x8')]['view'][_0x43d9('0x2a')](_0x43d9('0x1b'),()=>{_0x451f1a[_0x43d9('0x47')]({'channelId':_0x1a79fa,'threadId':_0x1e0022,'target':_0x8923d9});},{'priority':_0x43d9('0x3c')}):_0x451f1a[_0x43d9('0x3b')]({'channelId':_0x1a79fa,'threadId':_0x1e0022})[_0x43d9('0x39')](_0x3f8cbd=>{if('destroyed'!==_0x20118e['state']){if(_0x3f8cbd)_0x3f8cbd[_0x43d9('0x4e')](_0x8923d9);else{const _0x526791=this[_0x43d9('0xb')](_0x1e0022);_0x20118e[_0x43d9('0x4d')]['change'](_0x734fdd=>{for(const _0x42c8a6 of _0x526791)_0x734fdd['removeMarker'](_0x42c8a6);});}}});}}function F(_0x1d289e,_0x1daca0){return _0x1daca0?_0x1d289e+':'+_0x1daca0:_0x1d289e;}function q(_0x23ea30){const _0x510f50=_0x23ea30[_0x43d9('0x2f')](':');return{'group':_0x510f50[0x0],'id':_0x510f50[0x1],'part':_0x510f50[0x2]};}function z(_0x208ad6,_0x38d9a2){const _0x151a3e=_0x38d9a2['schema'],_0x32bed6=_0x38d9a2[_0x43d9('0x40')](_0x208ad6[_0x43d9('0x53')]);for(const _0x53d302 of _0x208ad6[_0x43d9('0x3')]()){const {type:_0x3d053d,item:_0x1ecb80,nextPosition:_0x4adbfd}=_0x53d302;if(_0x43d9('0x13')===_0x3d053d||_0x151a3e[_0x43d9('0x48')](_0x1ecb80)){const _0x5eea0b=_0x38d9a2[_0x43d9('0x50')](_0x1ecb80);_0x32bed6['isCollapsed']&&(_0x32bed6[_0x43d9('0x53')]=_0x5eea0b),_0x32bed6[_0x43d9('0x5')]=_0x4adbfd;}}return _0x32bed6[_0x43d9('0x10')]?null:_0x32bed6;}